@model projectevents.Models.Registration
<div class="container">
    <br />
    <div class="panel panel-default">
        <div class="panel-heading">Register</div>
        <div class="panel-body">
            @if (TempData["MessageRegistration"] != null)
            {
                <p class="alert alert-success" id="successMessage">@TempData["MessageRegistration"] <a class="btn btn-success" href="/Login/Login">Go To Sign in </a></p>
            }
            @Html.ValidationSummary()
            @Html.ValidationSummary(true)
            <form method="post" asp-controller="Registration" asp-action="Registration">
             
                <div class="row" id="divotp">
               
                        <div class="col-lg-4">
                            <label class="control-label">Mobileno</label>
                           <input id="otpmobile" asp-for="Mobileno" maxlength="10" name="Mobileno" onkeydown="return OnlyNumeric(this);" type="text" class="form-control" />
                    <span asp-validation-for="Mobileno" class="text-danger"></span>
                        </div>
                        <div class="col-lg-4" id="getotp">
                            <input type="button" value="Get OTP" class="btn btn-primary" onclick="return genotp();" />
                           
                        </div>
                        <div class="col-lg-4" id="divotpverify" style="display:none;">
                         
                                <label class="control-label">OTP</label>
                                <input id="otp" type="text" class="form-control" maxlength="6" placeholder="Enter OTP" />
                                @*<span asp-validation-for="otp" class="text-danger"></span>*@
                                <br />
                                <div>
                                    <input type="button" value="Verify OTP" class="btn btn-primary" onclick="return VarifyOtp();" />
                                    <input type="button" value="Change MobileNo" class="btn btn-primary" onclick="return changemobile();" />
                                </div>
                            
                        </div>
                    </div>
                    
                    <div id="divform" style="display:none;">
                        <div class="row">
                            <div class="col-lg-4">
                                <label class="control-label" asp-for="Name">Name</label>
                                <input asp-for="Name" type="text" class="form-control" />
                                <span asp-validation-for="Name" class="text-danger"></span>
                            </div>
                 
                            <div class="col-lg-4">
                                <label class="control-label" asp-for="Address">Address</label>
                                <input asp-for="Address" type="text" class="form-control" />
                                <span asp-validation-for="Address" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-4">
                                <label class="control-label" asp-for="EmailID">EmailID</label>
                                <input asp-for="EmailID" type="text" class="form-control" />
                                <span asp-validation-for="EmailID" class="text-danger"></span>
                            </div>
                            <div class="col-lg-4">
                                <label class="control-label" asp-for="Gender">Gender</label>
                                <br />
                                <input asp-for="Gender" type="radio" value="M" /> @Html.Label("", "Male")
                                <input asp-for="Gender" type="radio" value="F" />@Html.Label("", "Female")
                                <br />
                                <span asp-validation-for="Gender" class="text-danger"></span>
                            </div>
                            <div class="col-lg-4">
                                <label class="control-label" asp-for="Country">Country</label>
                                <select asp-for="Country"
                                        class="form-control"
                                        asp-items="@(new SelectList(string.Empty,"CountryID", "Name"))"></select>
                                <span asp-validation-for="Country" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-4">
                                <label class="control-label" asp-for="State">State</label>
                                <select asp-for="State" class="form-control"
                                        asp-items="@(new SelectList(string.Empty,"StateID", "StateName"))"></select>
                                <span asp-validation-for="State" class="text-danger"></span>
                            </div>
                            <div class="col-lg-4">
                                <label class="control-label" asp-for="City">City</label>
                                <select asp-for="City" class="form-control"
                                        asp-items="@(new SelectList(string.Empty,"CityID", "CityName"))"></select>
                                <span asp-validation-for="City" class="text-danger"></span>
                            </div>
                            <div class="col-lg-4">
                                <label class="control-label" asp-for="Birthdate">Birthdate</label>
                                <input asp-for="Birthdate" id="Birthdate" type="text" class="form-control" />
                                <span asp-validation-for="Birthdate" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-4">
                                <label class="control-label" asp-for="Username">Username</label>
                                <input asp-for="Username" onblur="CheckUsernameExists();" type="text" class="form-control" />
                                <span asp-validation-for="Username" class="text-danger"></span>
                            </div>
                            <div class="col-lg-4">
                                <label class="control-label" asp-for="Password">Password</label>
                                <input asp-for="Password" type="password" class="form-control" />
                                <span asp-validation-for="Password" class="text-danger"></span>
                            </div>
                            <div class="col-lg-4">
                                <label class="control-label" asp-for="ConfirmPassword">ConfirmPassword</label>
                                <input asp-for="ConfirmPassword" type="password" class="form-control" />
                                <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-4">
                                <br />
                                <input id="Submit1" type="submit" class="btn btn-primary" value="Register" />
                                <a class="btn btn-success" href="/Login/Login">Go To Sign in </a>
                            </div>

                        </div>
                    </div>
</form>

        </div>
    </div>
</div>


<script type="text/javascript">
    $(document).ready(function ()
    {
       
        $('#Country').change(function ()
        {
            @*var url = '@Url.Content("~/")' + "api/StateAPI";
                var ddlsource = "#Country";
            $.post(url, { id: $("#Country").val() }, function (data)
                {
                    var items = '';
                    $("#State").empty();
                    $.each(data, function (i, subcategory)
                    {
                        items += "<option value='" + subcategory.StateId + "'>" + subcategory.StateName + "</option>";
                    });
                    $('#State').html(items);

                });*@
            var x = $("#Country").val();
            $.ajax({
                url: '@Url.Content("~/")' + "api/StateAPI?id="+x,
                type: 'POST',
                success: function (data) {
                    var items = '';
                    $("#State").empty();
                    $.each(data, function (i, subcategory) {
                        items += "<option value='" + subcategory.StateID + "'>" + subcategory.StateName + "</option>";
                    });
                    $('#State').html(items);
                },
                error: function () {
                    alert("error");
                }
            });
          });

        $('#State').change(function ()
        {
            var ddlsource = "#State";
            var url = '@Url.Content("~/")' + "api/CityAPI?id=" + $(ddlsource).val();
           
                $.post(url, { id: $(ddlsource).val() }, function (data)
                {
                    var items = '';
                    $("#City").empty();
                    $.each(data, function (i, subcategory) {
                        items += "<option value='" + subcategory.CityID + "'>" + subcategory.CityName + "</option>";
                    });
                    $('#City').html(items);
                });
        });

        RebindState();
    });


    function RebindState()
    {
        if ('@Model.Country' != '')
        {
                var url = '@Url.Content("~/")' + "api/StateAPI";
                var ddlsource = "#Country";
                $.post(url, { id: '@Model.Country' }, function (data)
                {
                    var items = '';
                    $("#State").empty();
                    $.each(data, function (i, subcategory)
                    {
                        items += "<option value='" + subcategory.StateID + "'>" + subcategory.StateName + "</option>";
                    });
                    $('#State').html(items);

                    if ('@Model.State' !='')
                     {
                        $('#State').val('@Model.State');
                        RebindCities();
                     }
                });

        }
    }
     function getcountry() {
    
            $.getJSON('@Url.Content("~/")' + "api/CountryAPI", function (data) {
                var items = '';
                $("#Country").empty();
                $.each(data, function (i, subcategory) {
                    if (i == 0) {
                        items += "<option value='" + "" + "'>" + "----Select----" + "</option>";
                    }
                    else {
                        items += "<option value='" + subcategory.CountryID + "'>" + subcategory.Name + "</option>";
                    }
                });
                $('#Country').html(items);

                if ('@Model.Country' != '') {
                    $('#Country').val('@Model.Country');
                }
            });

        }

    function RebindCities()
    {
        if ('@Model.State' != '')
        {
            var url = '@Url.Content("~/")' + "api/CityAPI?id="+'@Model.State';
             var ddlsource = "#State";
                $.post(url, { id: '@Model.State' }, function (data)
                {
                    var items = '';
                    $("#City").empty();
                    $.each(data, function (i, subcategory) {
                        items += "<option value='" + subcategory.CityID + "'>" + subcategory.CityName + "</option>";
                    });
                    $('#City').html(items);

                     if ('@Model.City' !='')
                     {
                         $('#City').val('@Model.City');
                     }
                });
        }
    }


</script>
<script type="text/javascript">

    $(document).ready(function ()
    {
        $("#Birthdate").datepicker
            ({
            dateFormat: "yy-mm-dd",
            changeMonth: true,
            changeYear: true,
            yearRange: "-100:+100",
            onSelect: function (date)
            {
                var dob = new Date(date);
                var today = new Date();


                if (dob.getFullYear() + 18 < today.getFullYear())
                {

                }
                else
                {
                    $("#Birthdate").val('');
                    alert("You are not eligible for Registration");
                }
            }
        });
    });

    function OnlyNumeric(evt)
    {
        var charCode = (evt.which) ? evt.which : evt.keyCode
        if ((charCode < 48 || charCode > 57))
        {
            if (charCode == 8 || charCode == 46 || charCode == 0)
            {
                return true;
            }
            else {
                return false;
            }
        }
    }

    function CheckUsernameExists()
    {
        var url = '@Url.Content("~/")' + "Registration/CheckUserNameExists";
        var source = "#Username";
        $.post(url, { Username: $(source).val() }, function (data)
                {
                    if (data)
                    {
                        $(source).val('');
                        alert("Username Already Used try unique one!");
                    }
                    else
                    {

                    }
                });
    }


    function genotp() {
    
        if ($('#otpmobile').val() == '') {
            alert('Please enter Registered Mobile No.');
            return false;
        }

        if ($('#otpmobile').val() != '' && $('#otpmobile').val().length != 10) {
            alert('Registered Mobile No. should be 10 digits.');
            return false;
        }
        var url = '@Url.Action("getotp", "Registration")?MobileNo12=' + $("#otpmobile").val();
        $.ajax({
            type: "POST",
            url: url,
            data: '{MobileNo12: "' + $("#otpmobile").val() + '" }',

            contentType: "application/json; charset=utf-8",
            dataType: "json",
            async: false,
            success: function (response) {
                if (response != null) {
                    alert(response);

                } else {
                    alert("Please Get OTP");
                }
            },
            failure: function (response) {
                alert(response.responseText);
            },
            error: function (response) {

                alert(response.responseText)

                $("#divotpverify").css("display", "block");
                $("#otp").val('').attr("placeholder", "Enter the OTP received here");

                if (response.responseText == "OTP sent successfully") {
                    $("#otpmobile").attr("disabled", "disabled");

                    $("#getotp").attr("style", "display:none");
                }
            }
        });
    }
    function VarifyOtp() {
        //ValidateMobileNo();

        $.ajax({
            type: "POST",
            url: "/Registration/Varify?OTP=" + $("#otp").val(),
            data: '{OTP: "' + $("#otp").val() + '" }',

            contentType: "application/json; charset=utf-8",
            dataType: "json",
            async: false,
            success: function (response) {
                if (response != null) {
                    alert(response);
                   

                } else {
                    alert("Please Get OTP");
                }
            },
            failure: function (response) {
                alert(response.responseText);

            },
            error: function (response) {
                if (response.responseText == "Varify") {



                    $("#otp").val('').attr("placeholder", "Enter the OTP received here");
              
                    $("#getotp").css("display", 'none');

                    $("#otpmobile").prop("readOnly", true);

                    $("#divform").css("display", "block");
                              
              
                    $("#MobileNo").attr('disabled', false);
                    $("#divotpverify").css("display", "none");
                    getcountry();

                }
                else {

                    alert(response.responseText)
                }
            }
        });
    }
    function changemobile() {
      
        $("#otpmobile").prop("disabled", false);
        $("#otpmobile").val('').attr("placeholder", "Enter MobileNo.");
        $("#divotp").css("display", "block");
        $("#getotp").css("display", "block");
        $("#divotpverify").css("display", "none");
       
    }
</script>